<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>e-ticket Users</title>
    <link rel="stylesheet" href="../static/assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../static/assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="../static/assets/vendors/jvectormap/jquery-jvectormap.css">
    <link rel="stylesheet" href="../static/assets/vendors/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="../static/assets/vendors/owl-carousel-2/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/assets/vendors/owl-carousel-2/owl.theme.default.min.css">
    <link rel="stylesheet" href="../static/assets/css/style.css">
    <link rel="shortcut icon" href="../static/assets/images/favicon.png"/>

    <link rel="stylesheet" th:href="@{/assets/vendors/mdi/css/materialdesignicons.min.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/css/vendor.bundle.base.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/jvectormap/jquery-jvectormap.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/flag-icon-css/css/flag-icon.min.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/owl-carousel-2/owl.carousel.min.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/owl-carousel-2/owl.theme.default.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <link rel="shortcut icon" th:href="@{/assets/images/favicon.png}"/>
</head>
<body>
<div class="container-scroller">
    <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
            <a class="sidebar-brand brand-logo text-decoration-none" href="cabinet.html">E-TICKET</a>
            <a class="sidebar-brand brand-logo-mini text-decoration-none" href="cabinet.html">E-T</a>
        </div>
        <ul class="nav">
            <li class="nav-item profile">
                <div class="profile-desc">
                    <div class="profile-pic">
                        <div class="count-indicator">
                            <span class="count bg-success"></span>
                        </div>
                        <div class="profile-name">
                            <h5 class="mb-0 font-weight-normal owner-name"></h5>
                            <span>Gold Member</span>
                        </div>
                    </div>
                    <a href="#" id="profile-dropdown" data-toggle="dropdown"><i class="mdi mdi-dots-vertical"></i></a>
                    <div class="dropdown-menu dropdown-menu-right sidebar-dropdown preview-list"
                         aria-labelledby="profile-dropdown">
                        <a href="#" class="dropdown-item preview-item">
                            <div class="preview-thumbnail">
                                <div class="preview-icon bg-dark rounded-circle">
                                    <i class="mdi mdi-settings text-primary"></i>
                                </div>
                            </div>
                            <div class="preview-item-content">
                                <p class="preview-subject ellipsis mb-1 text-small">Account settings</p>
                            </div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item preview-item">
                            <div class="preview-thumbnail">
                                <div class="preview-icon bg-dark rounded-circle">
                                    <i class="mdi mdi-onepassword  text-info"></i>
                                </div>
                            </div>
                            <div class="preview-item-content">
                                <p class="preview-subject ellipsis mb-1 text-small">Change Password</p>
                            </div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item preview-item">
                            <div class="preview-thumbnail">
                                <div class="preview-icon bg-dark rounded-circle">
                                    <i class="mdi mdi-calendar-today text-success"></i>
                                </div>
                            </div>
                            <div class="preview-item-content">
                                <p class="preview-subject ellipsis mb-1 text-small">To-do list</p>
                            </div>
                        </a>
                    </div>
                </div>
            </li>
            <li class="nav-item nav-category">
                <span class="nav-link">Navigation</span>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   th:href="@{'http://localhost:80/api/auth/cabinet/'}">
              <span class="menu-icon">
                <i class="mdi mdi-speedometer"></i>
              </span>
                    <span class="menu-title">Dashboard</span>
                </a>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   th:href="@{'http://localhost:80/api/user/'}">
              <span class="menu-icon">
                <i class="mdi mdi-table-large"></i>
              </span>
                    <span class="menu-title">Users</span>
                </a>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   th:href="@{'http://localhost:80/api/destination/'}">
              <span class="menu-icon">
                <i class="mdi mdi-contacts"></i>
              </span>
                    <span class="menu-title">Destination</span>
                </a>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   th:href="@{'http://localhost:80/api/station/'}">
              <span class="menu-icon">
                <i class="mdi mdi-security"></i>
              </span>
                    <span class="menu-title">Station</span>
                </a>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   th:href="@{'http://localhost:80/api/order/'}">
              <span class="menu-icon">
                <i class="mdi mdi-playlist-play"></i>
              </span>
                    <span class="menu-title">Orders</span>
                </a>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   th:href="@{'http://localhost:80/api/train/'}">
              <span class="menu-icon">
                <i class="mdi mdi-chart-bar"></i>
              </span>
                    <span class="menu-title">Train</span>
                </a>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   th:href="@{'http://localhost:80/api/car/'}">
              <span class="menu-icon">
                <i class="mdi mdi-chart-bar"></i>
              </span>
                    <span class="menu-title">Car</span>
                </a>
            </li>
            <li class="nav-item menu-items">
                <a class="nav-link"
                   href="http://www.bootstrapdash.com/demo/corona-free/jquery/documentation/documentation.html">
              <span class="menu-icon">
                <i class="mdi mdi-file-document-box"></i>
              </span>
                    <span class="menu-title">Documentation</span>
                </a>
            </li>
        </ul>
    </nav>


    <div class="container-fluid page-body-wrapper">
        <nav class="navbar p-0 fixed-top d-flex flex-row">
            <div class="navbar-brand-wrapper d-flex d-lg-none align-items-center justify-content-center">
                <a class="navbar-brand brand-logo-mini" href="cabinet.html">E-TICKET</a>
            </div>
            <div class="navbar-menu-wrapper flex-grow d-flex align-items-stretch">
                <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
                    <span class="mdi mdi-menu"></span>
                </button>
                <ul class="navbar-nav w-100">
                    <li class="nav-item w-100">
                        <form class="nav-link mt-2 mt-md-0 d-none d-lg-flex search">
                            <input type="text" class="form-control" placeholder="Search products">
                        </form>
                    </li>
                </ul>

                <ul class="navbar-nav navbar-nav-right">
                    <li class="nav-item nav-settings d-none d-lg-block">
                        <a class="nav-link" href="#">
                            <i class="mdi mdi-view-grid"></i>
                        </a>
                    </li>
                    <li class="nav-item dropdown border-left">
                        <a class="nav-link count-indicator dropdown-toggle" id="messageDropdown" href="#"
                           data-toggle="dropdown" aria-expanded="false">
                            <i class="mdi mdi-email"></i>
                            <span class="count bg-success"></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
                             aria-labelledby="messageDropdown">
                            <h6 class="p-3 mb-0">Messages</h6>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item preview-item">
                                <div class="preview-thumbnail">
                                    <img th:src="@{/assets/images/faces/face4.jpg}" alt="image"
                                         class="rounded-circle profile-pic">
                                </div>
                                <div class="preview-item-content">
                                    <p class="preview-subject ellipsis mb-1">Mark send you a message</p>
                                    <p class="text-muted mb-0"> 1 Minutes ago </p>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item preview-item">
                                <div class="preview-thumbnail">
                                    <img th:src="@{/assets/images/faces/face2.jpg}" alt="image"
                                         class="rounded-circle profile-pic">
                                </div>
                                <div class="preview-item-content">
                                    <p class="preview-subject ellipsis mb-1">Cregh send you a message</p>
                                    <p class="text-muted mb-0"> 15 Minutes ago </p>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item preview-item">
                                <div class="preview-thumbnail">
                                    <img th:src="@{/assets/images/faces/face3.jpg}" alt="image"
                                         class="rounded-circle profile-pic">
                                </div>
                                <div class="preview-item-content">
                                    <p class="preview-subject ellipsis mb-1">Profile picture updated</p>
                                    <p class="text-muted mb-0"> 18 Minutes ago </p>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <p class="p-3 mb-0 text-center">4 new messages</p>
                        </div>
                    </li>
                    <li class="nav-item dropdown border-left">
                        <a class="nav-link count-indicator dropdown-toggle" id="notificationDropdown" href="#"
                           data-toggle="dropdown">
                            <i class="mdi mdi-bell"></i>
                            <span class="count bg-danger"></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
                             aria-labelledby="notificationDropdown">
                            <h6 class="p-3 mb-0">Notifications</h6>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item preview-item">
                                <div class="preview-thumbnail">
                                    <div class="preview-icon bg-dark rounded-circle">
                                        <i class="mdi mdi-calendar text-success"></i>
                                    </div>
                                </div>
                                <div class="preview-item-content">
                                    <p class="preview-subject mb-1">Event today</p>
                                    <p class="text-muted ellipsis mb-0"> Just a reminder that you have an event
                                        today </p>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item preview-item">
                                <div class="preview-thumbnail">
                                    <div class="preview-icon bg-dark rounded-circle">
                                        <i class="mdi mdi-settings text-danger"></i>
                                    </div>
                                </div>
                                <div class="preview-item-content">
                                    <p class="preview-subject mb-1">Settings</p>
                                    <p class="text-muted ellipsis mb-0"> Update dashboard </p>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item preview-item">
                                <div class="preview-thumbnail">
                                    <div class="preview-icon bg-dark rounded-circle">
                                        <i class="mdi mdi-link-variant text-warning"></i>
                                    </div>
                                </div>
                                <div class="preview-item-content">
                                    <p class="preview-subject mb-1">Launch Admin</p>
                                    <p class="text-muted ellipsis mb-0"> New admin wow! </p>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <p class="p-3 mb-0 text-center">See all notifications</p>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link" id="profileDropdown" href="#" data-toggle="dropdown">
                            <div class="navbar-profile">
                                <img class="xs rounded-circle" th:src="@{/assets/images/faces/face15.jpg}" alt="">
                                <p class="mb-0 d-none d-sm-block navbar-profile-name owner-name"></p>
                                <i class="mdi mdi-menu-down d-none d-sm-block"></i>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
                             aria-labelledby="profileDropdown">
                            <h6 class="p-3 mb-0">Profile</h6>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-divider"></div>
                            <a href="http://localhost:80/api/auth/logOut" class="dropdown-item preview-item">
                                <div class="preview-thumbnail">
                                    <div class="preview-icon bg-dark rounded-circle">
                                        <i class="mdi mdi-logout text-danger"></i>
                                    </div>
                                </div>
                                <div class="preview-item-content">
                                    <p class="preview-subject mb-1">Log out</p>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <p class="p-3 mb-0 text-center">Advanced settings</p>
                        </div>
                    </li>
                </ul>
                <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
                        data-toggle="offcanvas">
                    <span class="mdi mdi-format-line-spacing"></span>
                </button>
            </div>
        </nav>


        <div class="main-panel">
            <div class="content-wrapper">
                <div class="page-header">
                    <h3 class="page-title"> Admin Tables </h3>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a>Tables</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Data</li>
                        </ol>
                    </nav>
                </div>

                <div class="col-lg-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <div class="card-header">
                                <h4 class="card-title">Train Table</h4>
                                <button id="addTrain" onclick="addRow()"
                                        class="btn btn-outline-success float-right">Add
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover table-hover" id="tTrain">
                                    <thead>
                                    <tr>
                                        <th> #</th>
                                        <th> Type</th>
                                        <th> Code</th>
                                        <th class="bg-default rounded-pill"></th>
                                        <th class="bg-default rounded-pill"></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="train,count : ${trains}"
                                        th:id="@{'train'+${train.id}}">
                                        <td th:text="${count.count}"></td>
                                        <td>
                                            <input th:class="@{form-control}" class="form-control text-dark"
                                                   th:id="@{'type' + ${train.id}}" type="text"
                                                   th:value="${train.type}" disabled="true">
                                        </td>
                                        <td>
                                            <input th:class="@{form-control}" class="form-control text-dark"
                                                   th:id="@{'code' + ${train.id}}" type="text"
                                                   th:value="${train.code}" disabled="true">
                                        </td>
                                        <td>
                                            <button th:id="@{'edit' + ${train.id}}"
                                                    th:attr="onclick=${'edit('+train.id+')'}"
                                                    class="btn btn-outline-warning  rounded-pill">
                                                <h3>&#9997;</h3>
                                            </button>
                                        </td>
                                        <td>
                                            <button th:id="@{'del' + ${train.id}}"
                                                    th:attr="onclick=${'del('+train.id+')'}"
                                                    class="btn btn-outline-danger  rounded-pill">
                                                <h3>&#9760;</h3>
                                            </button>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>
</div>
<script src="../static/assets/vendors/js/vendor.bundle.base.js"></script>
<script src="../static/assets/vendors/chart.js/Chart.min.js"></script>
<script src="../static/assets/vendors/progressbar.js/progressbar.min.js"></script>
<script src="../static/assets/vendors/jvectormap/jquery-jvectormap.min.js"></script>
<script src="../static/assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="../static/assets/vendors/owl-carousel-2/owl.carousel.min.js"></script>
<script src="../static/assets/js/off-canvas.js"></script>
<script src="../static/assets/js/hoverable-collapse.js"></script>
<script src="../static/assets/js/misc.js"></script>
<script src="../static/assets/js/settings.js"></script>
<script src="../static/assets/js/todolist.js"></script>
<script src="../static/assets/js/dashboard.js"></script>


<script th:src="@{/assets/vendors/js/vendor.bundle.base.js}"></script>
<script th:src="@{/assets/vendors/chart.js/Chart.min.js}"></script>
<script th:src="@{/assets/vendors/progressbar.js/progressbar.min.js}"></script>
<script th:src="@{/assets/vendors/jvectormap/jquery-jvectormap.min.js}"></script>
<script th:src="@{/assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js}"></script>
<script th:src="@{/assets/vendors/owl-carousel-2/owl.carousel.min.js}"></script>
<script th:src="@{/assets/js/off-canvas.js}"></script>
<script th:src="@{/assets/js/hoverable-collapse.js}"></script>
<script th:src="@{/assets/js/misc.js}"></script>
<script th:src="@{/assets/js/settings.js}"></script>
<script th:src="@{/assets/js/todolist.js}"></script>
<script th:src="@{/assets/js/dashboard.js}"></script>

<script type="text/javascript">
    let customId = Number.MIN_SAFE_INTEGER;

    function edit(id) {
        var type = document.getElementById("type" + id)
        var code = document.getElementById("code" + id)
        var editBtn = document.getElementById("edit" + id)
        if (type.disabled === true) {
            type.disabled = false;
            type.className = "form-control text-white";
            code.disabled = false;
            code.className = "form-control text-white";
            editBtn.innerHTML = '<h3>&#10004;</h3>';
            editBtn.className = 'btn btn-outline-success rounded-pill'
        } else {
            document.getElementById("addTrain").disabled = false
            type.disabled = true;
            type.className = "form-control text-dark";
            code.disabled = true;
            code.className = "form-control text-dark";
            editBtn.innerHTML = '<h3>&#9997;</h3>';
            editBtn.className = 'btn btn-outline-warning rounded-pill'
            const xhr = new XMLHttpRequest()
            const url = "http://localhost:80/api/train?id=" + id + "&type=" + type.value + "&code=" + code.value+ "&token=" + localStorage.getItem("token");
            xhr.responseType = 'json';
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE && id < 0) {
                    let newId = xhr.response.data.id
                    type.id = "type" + newId
                    code.id = "code" + newId
                    editBtn.id = "edit" + newId
                    editBtn.onclick = () => edit(newId)
                    let delBtn = document.getElementById('del' + id);
                    delBtn.onclick = () => del(newId)
                    delBtn.id = 'del' + newId
                    document.getElementById('train' + id).id = 'train' + newId;
                }
            }
            xhr.open('PUT', url, true);
            xhr.send();
        }
    }

    function del(id) {
        document.getElementById('train' + id).innerHTML = ""
        if (id > 0) {
            var xhr = new XMLHttpRequest()
            const url = "http://localhost:80/api/train?id=" + id+ "&token=" + localStorage.getItem("token");
            xhr.open('DELETE', url, true);
            xhr.send();
        } else
            document.getElementById("addTrain").disabled = false
    }
    function addRow() {
        document.getElementById("addTrain").disabled = true
        $('#tTrain').append('<tr id=' + "train" + customId + '>' +
            '<td>' + document.getElementById("tTrain").rows.length + '</td>' +
            '<td>' +
            ' <input th:class="@{form-control}" class="form-control text-white" id=' + "type" + customId + ' type="text">' +
            '</td>' +
            '<td>' +
            ' <input th:class="@{form-control}" class="form-control text-white" id=' + "code" + customId + ' type="text">' +
            '</td>' +
            '<td>' +
            '<button id=' + "edit" + customId + ' ' +
            '                                                    onclick="edit(' + customId + ')"\n' +
            '                                                    class="btn btn-outline-success  rounded-pill">\n' +
            '                                                <h3>&#10004;</h3>' +
            '</td>' +
            '<td>' +
            '<button id=' + "del" + customId + ' ' +
            '                                                    onclick="del(' + customId + ')" \n' +
            '                                                    class="btn btn-outline-danger  rounded-pill">\n' +
            '                                                <h3>&#9760;</h3>' +
            '</td>' +
            '</tr>');
        customId++;
    }
</script>
<script th:inline="javascript">
    var ownerName = document.getElementsByClassName("owner-name")
    var paths = document.getElementsByClassName("nav-link")
    for (let i = 0; i < paths.length; i++)
        paths[i].href = paths[i].href + localStorage.getItem("token")
    for (let i = 0; i < ownerName.length; i++)
        ownerName[i].innerHTML = localStorage.getItem("name")
</script>
</body>
</html>